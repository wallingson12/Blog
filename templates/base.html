<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- Estilo personalizado -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- Navbar estilo Facebook -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm py-2">
    <div class="container-fluid">
        <!-- Logo -->
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('posts.index') }}">
            <img src="{{ url_for('static', filename='Logo.jpg') }}" alt="Logo" style="height:40px;">
            <span class="ms-2">Ping</span>
        </a>

        <!-- Toggler para mobile -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- ConteÃºdo da navbar -->
        <div class="collapse navbar-collapse justify-content-between" id="navbarContent">

            <!-- Barra de busca central -->
        <form class="mx-auto navbar-search" action="{{ url_for('search.buscar_usuarios') }}" method="GET" style="position: relative; width: 100%; max-width: 400px;">
            <input type="text" name="q" class="form-control search-input border-0"
                   placeholder="Buscar no Ping" aria-label="Buscar" style="padding-left: 40px;">
            <!-- Ãcone de lupa dentro do input -->
            <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #65676b;">
                ğŸ”
            </span>
        </form>

            <!-- BotÃµes Ã  direita -->
            <ul class="navbar-nav align-items-center gap-2">
                {% if current_user.is_authenticated %}
                    <li class="nav-item"><a href="{{ url_for('messages.listar_chats') }}" class="btn btn-outline-light rounded-pill px-3 py-1">ğŸ’¬ Mensagens</a></li>
                    <li class="nav-item"><a href="{{ url_for('profile.perfil') }}" class="btn btn-secondary rounded-pill px-3 py-1">ğŸ‘¤ Perfil</a></li>
                    <li class="nav-item"><a href="{{ url_for('posts.sobre') }}" class="btn btn-outline-info rounded-pill px-3 py-1">â„¹ï¸ Sobre</a></li>
                    <li class="nav-item"><a href="{{ url_for('auth.logout') }}" class="btn btn-danger rounded-pill px-3 py-1">Logout</a></li>
                {% else %}
                    <li class="nav-item"><a href="{{ url_for('auth.login') }}" class="btn btn-primary rounded-pill px-3 py-1">ğŸ”‘ Login</a></li>
                    <li class="nav-item"><a href="{{ url_for('auth.register') }}" class="btn btn-success rounded-pill px-3 py-1">ğŸ“ Registrar</a></li>
                {% endif %}
            </ul>

        </div>
    </div>
</nav>

<!-- ConteÃºdo principal com barras laterais -->
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Barra lateral esquerda -->
        <div class="col-md-3 d-none d-md-block">
            <div class="sticky-top" style="top: 80px;">
                <ul class="list-group">
                    {% if current_user.is_authenticated %}
                    <li class="list-group-item"><a href="{{ url_for('posts.index') }}" class="text-decoration-none">ğŸ  InÃ­cio</a></li>
                    <li class="list-group-item"><a href="{{ url_for('search.buscar_usuarios') }}" class="text-decoration-none">ğŸ” Explorar</a></li>
                    <li class="list-group-item"><a href="{{ url_for('messages.listar_chats') }}" class="text-decoration-none">ğŸ’¬ Mensagens</a></li>
                    <li class="list-group-item"><a href="{{ url_for('profile.perfil') }}" class="text-decoration-none">ğŸ‘¤ Perfil</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <!-- Feed central -->
        <div class="col-md-6">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endwith %}

            {% block content %}{% endblock %}
        </div>

        <!-- Barra lateral direita -->
        <div class="col-md-3 d-none d-md-block">
            <div class="sticky-top" style="top: 80px;">
                <!-- EspaÃ§o para anÃºncios, sugestÃµes, etc -->
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('input[name="q"]');
    if (!searchInput) return;

    // Cria a lista de sugestÃµes dinamicamente
    const suggestions = document.createElement('ul');
    suggestions.classList.add('list-group', 'position-absolute');
    suggestions.style.zIndex = '1000';
    suggestions.style.width = '100%';
    suggestions.style.display = 'none';
    searchInput.parentNode.style.position = 'relative';
    searchInput.parentNode.appendChild(suggestions);

    searchInput.addEventListener('input', async function() {
        const query = this.value.trim();
        if (!query) {
            suggestions.style.display = 'none';
            return;
        }

        try {
            const response = await fetch(`/autocomplete?q=${encodeURIComponent(query)}`);
            const users = await response.json();

            suggestions.innerHTML = '';
            if (users.length === 0) {
                suggestions.style.display = 'none';
                return;
            }

            users.forEach(user => {
                const li = document.createElement('li');
                li.classList.add('list-group-item', 'border-0', 'd-flex', 'align-items-center', 'gap-2');
                li.style.cursor = 'pointer';

                // Cria a imagem do avatar
                const img = document.createElement('img');
                img.src = user.avatar;
                img.style.width = '30px';
                img.style.height = '30px';
                img.style.borderRadius = '50%';
                img.style.objectFit = 'cover';

                // Cria o nome
                const span = document.createElement('span');
                span.textContent = user.name;

                li.appendChild(img);
                li.appendChild(span);

                li.onclick = () => window.location.href = user.url;
                suggestions.appendChild(li);
            });

            suggestions.style.display = 'block';
        } catch (err) {
            console.error(err);
            suggestions.style.display = 'none';
        }
    });

    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
            suggestions.style.display = 'none';
        }
    });
});
</script>
</body>
</html>